<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Mobile Harvest Portal</title>

<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
<script type="text/javascript" src="http://static.stackmob.com/js/json2-min.js"></script>
<script type="text/javascript" src="http://static.stackmob.com/js/underscore-1.4.1-min.js"></script>
<script type="text/javascript" src="http://static.stackmob.com/js/backbone-0.9.2-min.js"></script>
<script type="text/javascript" src="http://static.stackmob.com/js/2.5.3-crypto-sha1-hmac.js"></script>
<script type="text/javascript" src="http://static.stackmob.com/js/stackmob-js-0.6.0-min.js"></script>

<script type="text/javascript" src="bootstrap/js/bootstrap.js"></script>
<link type="text/css" rel="stylesheet" href="bootstrap/css/bootstrap.css"></link>
<link type="text/css" rel="stylesheet" href="assets/css/basestyle.css"></link>


<script type="text/javascript">

StackMob.init({
    appName: "testfunc",
    clientSubdomain: "prashanthpattabigmailcom",
    publicKey: "763e6283-1507-4084-91bf-4b1ba61009bc",
    userSchema: 'portal_user',
    loginField: 'username', //the username you are using as the login field
    passwordField: 'password', //the password field you are using as the password field
    apiVersion: 0
});


</script>

</head>
<body>

  
  <div class="modal" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true" style="display:none">Ã—</button>
      <h3 id="myModalLabel">Mobile Harvest</h3>
    </div>
    <div class="modal-body">
      <p>
        <form id="login_form">
          <label for="username">Username</label>
          <input type="text" id="username" name="username"><br/>
          
          <label for="password">Password</label>
          <input type="password" id="password" name="password">
        </form>
      </p>
    </div>
    <div class="modal-footer">
      <button class="btn" data-dismiss="modal" aria-hidden="true" style="display:none">Close</button>
      <input type="button" id="login_form_submit" class="btn btn-primary" form="login_form" value="Login">
    </div>
    
    <script>


    
      $("#login_form_submit").click(function(e){
    	  e.preventDefault();
    	  
    	  var username = $("#username").val();
    	  var password = $("#password").val();

    	  
    	  
    		var user = new StackMob.User({username: username, password: password});
    		
    		
    		
    		/* --------------------------------------------------
    		 *								LOGIN A USER
    		 * ---------------------------------------------------- */
    		
    		//Makes a call to StackMob to request a login
    		user.login(false,{
    			success: function(model){
    		    //show a success message/update your UI
    		    alert("Login successful");
    		    //alert(JSON.stringify(model));
    		    
    		    if(typeof(Storage)!=="undefined"){
             // Yes! localStorage and sessionStorage support!
    		     sessionStorage.username = model.username;
    		     sessionStorage.auth = "success";
    		     alert(sessionStorage.getItem('username'));
    		     window.location = "test.html";
            }
          	else{
             alert("Sorry! No web storage support..");
            }
    		    
    		    
    		  }, 
    		  error: function(model, response) {
    		    //show a failure message in your app    
    		    alert("Login Failed "+ JSON.stringify(model));
    		  }
    		});
    		
    		 
    		
    		
    		/* --------------------------------------------------
    		 *								CREATING A NEW USER
    		 * ---------------------------------------------------- */
    		 
    		 /*
    		user.create({
    			success:function(model){
    				$("#output_box").html(JSON.stringify(model));
    			},
    			failue: function(){
    				alert("Unable to fetch content.");
    			}
    		});
    		
    		*/
    		
    		
    		
    		
    		
      });
    </script>
  </div>
  
  <div id="output_box" style="font-family: arial; font-size: 11px; color: #000;">
  </div>
  
</body>
</html>
